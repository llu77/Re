"""
Case Assessment Chain โ ุณูุณูุฉ ุชูููู ุงูุญุงูุฉ ุงููุงููุฉ
====================================================
Prompt Chaining: Intake โ Assessment โ Evidence โ Plan โ Review โ Documentation
"""

import os
import json
import anthropic
from typing import Optional

from tools.pubmed import search_pubmed_api, fetch_pubmed_article
from tools.calculator import calculate_visual_params
from tools.knowledge_base import search_vector_db
from tools.documents import generate_medical_document
from utils.security import sanitize_patient_input, validate_medical_output


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุงูู System Prompt ุงูุฃุณุงุณู (ูุณุชูุฑุฏ ูู rehab_consultant)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

try:
    from rehab_consultant import SYSTEM_PROMPT, TOOLS, execute_tool
except ImportError:
    # fallback ุจุณูุท ุฅู ูู ูุชููุฑ
    SYSTEM_PROMPT = "ุฃูุช ุงุณุชุดุงุฑู ุชุฃููู ุจุตุฑู ูุชุฎุตุต."
    TOOLS = []
    execute_tool = lambda name, inp: {"error": "tools not loaded"}


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุงุณุชุฏุนุงุก ุณูุณูุฉ ูุงุญุฏุฉ ูุน Tool Support
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

def chain_call(
    phase_instruction: str,
    user_message: str,
    images: Optional[list] = None,
    use_tools: bool = False,
    thinking_budget: int = 8000
) -> str:
    """
    ุงุณุชุฏุนุงุก ูุฑุญูุฉ ูุงุญุฏุฉ ูู ุงูุณูุณูุฉ

    Args:
        phase_instruction: ุชุนูููุงุช ุงููุฑุญูุฉ ุงูุญุงููุฉ
        user_message: ุฑุณุงูุฉ ุงููุณุชุฎุฏู/ุงูุณูุงู
        images: ูุงุฆูุฉ ุงูุตูุฑ (ุงุฎุชูุงุฑูุฉ)
        use_tools: ุชูุนูู ุงูุฃุฏูุงุช ูู ูุฐู ุงููุฑุญูุฉ
        thinking_budget: ุญุฏ ุฑููุฒ ุงูุชูููุฑ

    Returns:
        ูุต ุงุณุชุฌุงุจุฉ ุงููุฑุญูุฉ
    """
    client = anthropic.Anthropic(api_key=os.environ.get("ANTHROPIC_API_KEY"))

    # System Prompt + ุชุนูููุงุช ุงููุฑุญูุฉ
    phase_system = SYSTEM_PROMPT + f"\n\n<current_phase>\n{phase_instruction}\n</current_phase>"

    # ุจูุงุก ุงููุญุชูู
    content = []
    if images:
        for img in images:
            content.append({
                "type": "image",
                "source": {
                    "type": "base64",
                    "media_type": img["media_type"],
                    "data": img["data"]
                }
            })
    content.append({"type": "text", "text": user_message})

    messages = [{"role": "user", "content": content}]

    api_params = {
        "model": "claude-sonnet-4-6",
        "max_tokens": 8192,
        "system": phase_system,
        "messages": messages,
        "thinking": {"type": "enabled", "budget_tokens": thinking_budget}
    }

    if use_tools and TOOLS:
        api_params["tools"] = TOOLS

    # ุญููุฉ ูุน ุฏุนู Tool Use
    while True:
        response = client.messages.create(**api_params)

        if response.stop_reason == "end_turn":
            # ุงุณุชุฎุฑุงุฌ ุงููุต
            text_parts = [
                block.text
                for block in response.content
                if hasattr(block, "type") and block.type == "text"
            ]
            return "\n".join(text_parts)

        if response.stop_reason == "tool_use" and use_tools:
            messages.append({"role": "assistant", "content": response.content})

            tool_results = []
            for block in response.content:
                if hasattr(block, "type") and block.type == "tool_use":
                    result = execute_tool(block.name, block.input)
                    tool_results.append({
                        "type": "tool_result",
                        "tool_use_id": block.id,
                        "content": json.dumps(result, ensure_ascii=False)
                    })

            messages.append({"role": "user", "content": tool_results})
            api_params["messages"] = messages

        else:
            # ุงุณุชุฌุงุจุฉ ุบูุฑ ูุชููุนุฉ
            text_parts = [
                block.text
                for block in response.content
                if hasattr(block, "type") and block.type == "text"
            ]
            return "\n".join(text_parts)


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุณูุณูุฉ ุงูุชูููู ุงููุงููุฉ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

def full_case_assessment(
    patient_data: dict,
    images: Optional[list] = None,
    include_pubmed_search: bool = True
) -> dict:
    """
    ุณูุณูุฉ ุชูููู ูุงููุฉ ูุญุงูุฉ ุชุฃููู ุจุตุฑู

    ุงููุฑุงุญู:
    1. ุงูุงุณุชูุจุงู ูุงูููู (Intake)
    2. ุงูุชูููู ูุงูุชุญููู (Assessment)
    3. ุงูุจุญุซ ุงูุนููู (Evidence Search)
    4. ุจูุงุก ุงูุฎุทุฉ (Treatment Plan)
    5. ุงููุฑุงุฌุนุฉ ุงูุฐุงุชูุฉ (Quality Review)

    ุงููุฑุญูุฉ 6 (ุงูุชูุซูู) ุชุชุทูุจ ููุงููุฉ ุตุฑูุญุฉ ูู ุงููุณุชุฎุฏู ููุง ุชูููููุฐ ุชููุงุฆูุงู.

    Args:
        patient_data: ุจูุงูุงุช ุงููุฑูุถ
        images: ุตูุฑ ุงููุญูุตุงุช (ุงุฎุชูุงุฑูุฉ)
        include_pubmed_search: ุงูุจุญุซ ูู PubMed (ุงุฎุชูุงุฑู)

    Returns:
        dict: ูุชุงุฆุฌ ูู ูุฑุญูุฉ
    """
    print("=" * 60)
    print("๐ฅ ุจุฏุก ุณูุณูุฉ ุงูุชูููู ุงููุงููุฉ")
    print("=" * 60)

    results = {}

    # โโโ ุงููุฑุญูุฉ 1: ุงูุงุณุชูุจุงู โโโ
    print("\n๐ ุงููุฑุญูุฉ 1/5: ุงูุงุณุชูุจุงู ูุงูููู...")
    intake_response = chain_call(
        phase_instruction="""ุฃูุช ุงูุขู ูู ูุฑุญูุฉ ุงูุงุณุชูุจุงู (Intake).
ูููุชู: ููู ูุชูุธูู ูุนูููุงุช ุงูุญุงูุฉ ุงููุงุฑุฏุฉ.
ุฃุฎุฑุฌ ูุชูุฌุชู ูู ุชูุณูู ููุธู ูุดูู:
- ุงูุชุดุฎูุต ุงูุฃุณุงุณู ูุงููุตุงุญุจ
- ุชุตููู ุถุนู ุงูุจุตุฑ ุญุณุจ WHO/ICD-11
- ุงููุนูููุงุช ุงููุงูุตุฉ ุงูุชู ุชุญุชุงุฌ ุงุณุชููุงู
- ุงูุฃููููุงุช ุงูุนูุงุฌูุฉ ุงููุจุฏุฆูุฉ""",

        user_message=f"""ุญูู ุจูุงูุงุช ุงููุฑูุถ ุงูุชุงููุฉ:

<patient_data>
{json.dumps(patient_data, ensure_ascii=False, indent=2)}
</patient_data>

ูุฏู ุชููููุงู ูุจุฏุฆูุงู ุดุงููุงู ููุธูุงู."""
    )

    results["intake"] = intake_response
    print("โ ุงูุชูู ุงูุงุณุชูุจุงู")

    # โโโ ุงููุฑุญูุฉ 2: ุงูุชูููู (ูุน ุตูุฑ ุงุฎุชูุงุฑูุฉ) โโโ
    print("\n๐ ุงููุฑุญูุฉ 2/5: ุงูุชูููู ูุงูุชุญููู...")
    assessment_input = f"""ุจูุงุกู ุนูู ุงูุงุณุชูุจุงู ุงููุจุฏุฆู:
<intake_summary>
{intake_response}
</intake_summary>

ูุฏู ุชููููุงู ุจุตุฑูุงู ูุธูููุงู ููุตูุงู ูุดูู:
1. ุชุญููู ูุชุงุฆุฌ ุงููุญูุตุงุช ุงููุชุงุญุฉ
2. ุงููููุฏ ุงููุธูููุฉ ุงููุชููุนุฉ
3. ุงูุนูุงูู ุงููุคุซุฑุฉ ุนูู ุฎุทุฉ ุงูุชุฃููู
4. ุงูุฃูุฏุงู ุงููุธูููุฉ ุงูููุชุฑุญุฉ"""

    if images:
        assessment_input += "\n\nุญูู ุงูุตูุฑ/ุงููุญูุตุงุช ุงููุฑููุฉ ูุฑุจุทูุง ุจุงูุญุงูุฉ ุงูุณุฑูุฑูุฉ."

    assessment_response = chain_call(
        phase_instruction="ุฃูุช ุงูุขู ูู ูุฑุญูุฉ ุงูุชูููู ุงูุจุตุฑู ุงููุธููู.",
        user_message=assessment_input,
        images=images if images else None,
        thinking_budget=10000
    )

    results["assessment"] = assessment_response
    print("โ ุงูุชูู ุงูุชูููู")

    # โโโ ุงููุฑุญูุฉ 3: ุงูุจุญุซ ุงูุนููู โโโ
    print("\n๐ฌ ุงููุฑุญูุฉ 3/5: ุงูุจุญุซ ุงูุนููู ูุงูุฃุฏูุฉ...")

    if include_pubmed_search:
        evidence_response = chain_call(
            phase_instruction="""ุฃูุช ุงูุขู ูู ูุฑุญูุฉ ุงูุจุญุซ ุงูุนููู.
ุงุณุชุฎุฏู ุฃุฏูุงุช search_pubmed ูsearch_knowledge_base ููุจุญุซ ุนู:
- ุฃุญุฏุซ ุจุฑูุชููููุงุช ุงูุชุฃููู ููุฐู ุงูุญุงูุฉ
- ูุนุงููุฉ ุงูุชุฏุฎูุงุช ุงูููุชุฑุญุฉ
- ุงูุฅุฑุดุงุฏุงุช ุงูุณุฑูุฑูุฉ ุฐุงุช ุงูุตูุฉ""",

            user_message=f"""ุจูุงุกู ุนูู ุงูุชูููู:
<assessment>
{assessment_response[:3000]}
</assessment>

ุงุจุญุซ ุนู ุงูุฃุฏูุฉ ุงูุนูููุฉ ุงูุฏุงุนูุฉ ููุชุฏุฎูุงุช ุงูุชุฃููููุฉ ุงูููุงุณุจุฉ ููุฐู ุงูุญุงูุฉ.
ุงุณุชุฎุฏู search_pubmed ูsearch_knowledge_base.""",

            use_tools=True,
            thinking_budget=8000
        )
    else:
        evidence_response = chain_call(
            phase_instruction="ุฃูุช ูู ูุฑุญูุฉ ูุฑุงุฌุนุฉ ุงูุฃุฏูุฉ ุงูุนูููุฉ. ุงุณุชูุฏ ููุนุฑูุชู ุงูุณุฑูุฑูุฉ.",
            user_message=f"""ุจูุงุกู ุนูู ุงูุชูููู:
<assessment>
{assessment_response[:3000]}
</assessment>

ูุง ุงูุฃุฏูุฉ ุงูุนูููุฉ ุงูุฏุงุนูุฉ ููุชุฏุฎูุงุช ุงูุชุฃููููุฉ ุงูููุงุณุจุฉุ
ุงุณุชุฎุฏู search_knowledge_base ููุจุญุซ ูู ุงููุงุนุฏุฉ ุงููุนุฑููุฉ ุงููุญููุฉ.""",
            use_tools=True
        )

    results["evidence"] = evidence_response
    print("โ ุงูุชูู ุงูุจุญุซ ุงูุนููู")

    # โโโ ุงููุฑุญูุฉ 4: ุจูุงุก ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ โโโ
    print("\n๐ ุงููุฑุญูุฉ 4/5: ุจูุงุก ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ...")
    plan_response = chain_call(
        phase_instruction="""ุฃูุช ุงูุขู ูู ูุฑุญูุฉ ุจูุงุก ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ ุงูุดุงููุฉ.
ุงูุฎุทุฉ ูุฌุจ ุฃู ุชุชุจุน ูููุฐุฌ SMART Goals ูุชุดูู:
- ุฃูุฏุงู ูุตูุฑุฉ/ูุชูุณุทุฉ/ุทูููุฉ ุงููุฏู
- ุงูุชุฏุฎูุงุช ูุงูุฃุฌูุฒุฉ ุงููุณุงุนุฏุฉ
- ุงูุฌุฏูู ุงูุฒููู ููุนุงููุฑ ุงููุฌุงุญ
- ุฎุทุฉ ุงููุชุงุจุนุฉ ูุงูุชูููู""",

        user_message=f"""ุจูุงุกู ุนูู ุฌููุน ุงููุนูููุงุช ุงูุณุงุจูุฉ:

<intake>
{intake_response[:1500]}
</intake>

<assessment>
{assessment_response[:1500]}
</assessment>

<evidence>
{evidence_response[:1500]}
</evidence>

ุถุน ุฎุทุฉ ุชุฃููู ุจุตุฑู ุดุงููุฉ ูููุตูุฉ ูุจููุฉ ุนูู ุงูุฃุฏูุฉ.""",

        use_tools=True,  # ูุญุณุงุจุงุช ุงูุชูุจูุฑ ุงููุทููุจุฉ
        thinking_budget=12000
    )

    results["plan"] = plan_response
    print("โ ุงูุชููุช ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ")

    # โโโ ุงููุฑุญูุฉ 5: ุงููุฑุงุฌุนุฉ ุงูุฐุงุชูุฉ โโโ
    print("\nโ๏ธ ุงููุฑุญูุฉ 5/5: ุงููุฑุงุฌุนุฉ ูุงูุชุญูู ูู ุงูุฌูุฏุฉ...")
    review_response = chain_call(
        phase_instruction="""ุฃูุช ุงูุขู ูุฏูู ุฌูุฏุฉ ุทุจูุฉ.
ุฑุงุฌุน ุงูุฎุทุฉ ุจุนูู ูุงูุฏุฉ ููุถูุนูุฉ. ุชุญูู ูู:
1. ูุงูุนูุฉ ุงูุฃูุฏุงู ููุงุจููุชูุง ููููุงุณ
2. ููุฉ ุงูุฃุฏูุฉ ุงูุฏุงุนูุฉ
3. ุงูุชูุงุณู ูุงูุงุชุณุงู ุงูุฏุงุฎูู
4. ุงููุฌูุงุช ูุงููุฎุงุทุฑ ุงููุญุชููุฉ
5. ููุงุกูุฉ ุงูุฎุทุฉ ูููุฑูุถ ุชุญุฏูุฏุงู
ูุง ุชุชุฑุฏุฏ ูู ุงูุฅุดุงุฑุฉ ููููุงุท ุงูุถุนููุฉ.""",

        user_message=f"""ุฑุงุฌุน ูุฐู ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ:

<treatment_plan>
{plan_response[:4000]}
</treatment_plan>

ูููู ุจููุถูุนูุฉ: ููุงุท ุงูููุฉุ ููุงุท ุงูุถุนูุ ูุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ."""
    )

    results["review"] = review_response
    print("โ ุงูุชููุช ุงููุฑุงุฌุนุฉ")

    # โโโ ููุงุญุธุฉ ุงููุฑุญูุฉ 6 (ุงูุชูุซูู) โโโ
    results["documentation_status"] = "pending_consent"
    results["documentation_note"] = (
        "ุงููุฑุญูุฉ 6 (ุงูุชูุซูู) ุชุชุทูุจ ููุงููุฉ ุตุฑูุญุฉ ูู ุงููุฑูุถ/ุงููุนุงูุฌ. "
        "ุงุณุชุฎุฏู generate_document() ุจุนุฏ ุงูุญุตูู ุนูู ุงูููุงููุฉ."
    )

    print("\n" + "=" * 60)
    print("โ ุงูุชููุช ุณูุณูุฉ ุงูุชูููู ุงููุงููุฉ!")
    print("=" * 60)

    return results


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุชุญูู ุฐุงุชู ูู ุงูุฅุฌุงุจุฉ (Self-Verification)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

def verify_response(question: str, answer: str) -> dict:
    """
    ูุฑุงุฌุนุฉ ุฐุงุชูุฉ ูุฌูุฏุฉ ุงูุฅุฌุงุจุฉ ุงูุทุจูุฉ

    Args:
        question: ุงูุณุคุงู ุงูุฃุตูู
        answer: ุงูุฅุฌุงุจุฉ ุงููููุฏุฉ

    Returns:
        dict: ุงูุชูููู ูุงูุฅุฌุงุจุฉ ุงููุญุณูุฉ (ุฅู ูุฌุฏุช)
    """
    client = anthropic.Anthropic(api_key=os.environ.get("ANTHROPIC_API_KEY"))

    verification_prompt = f"""ุฃูุช ูุฏูู ุฌูุฏุฉ ุทุจูุฉ ูุชุฎุตุต ูู ุงูุชุฃููู ุงูุจุตุฑู.
ุฑุงุฌุน ุงูุฅุฌุงุจุฉ ุงูุชุงููุฉ:

<original_question>
{question}
</original_question>

<generated_answer>
{answer}
</generated_answer>

ูููู ุงูุฅุฌุงุจุฉ ูู ุญูุซ (ุฏุฑุฌุฉ 1-5 ููู ูุนูุงุฑ):
1. **ุงูุฏูุฉ ุงูุทุจูุฉ**: ูู ุงููุนูููุงุช ุตุญูุญุฉุ
2. **ุงูุงูุชูุงู**: ูู ุฃูุฌูุจ ุนูู ุงูุณุคุงู ุจุดูู ุดุงููุ
3. **ูุถูุญ ุงูุชูุตูุงุช**: ูู ุงูุชูุตูุงุช ุนูููุฉ ููุงุจูุฉ ููุชูููุฐุ
4. **ุงูุงุณุชูุงุฏ ููุฃุฏูุฉ**: ูู ุงูุชูุตูุงุช ูุจููุฉ ุนูู ุฃุฏูุฉ ุนูููุฉุ
5. **ุงูุฃูุงู**: ูู ููุฌุฏ ุฃู ุดูุก ูุฏ ูุถุฑ ุงููุฑูุถุ

ุฅุฐุง ูุงู ุฃู ูุนูุงุฑ < 4ุ ูุฏู ุฅุฌุงุจุฉ ูุญุณูุฉ.

ุฃุฌุจ ุจุงูุชูุณูู:
ุงูุฏูุฉ: X/5
ุงูุงูุชูุงู: X/5
ุงููุถูุญ: X/5
ุงูุฃุฏูุฉ: X/5
ุงูุฃูุงู: X/5

ุงููุดุงูู ุงูููุฌูุฏุฉ: [...]
ุงูุฅุฌุงุจุฉ ุงููุญุณูุฉ: [ุฅู ูุฒู]"""

    response = client.messages.create(
        model="claude-sonnet-4-6",
        max_tokens=4096,
        system=SYSTEM_PROMPT,
        messages=[{"role": "user", "content": verification_prompt}]
    )

    verification_text = ""
    for block in response.content:
        if hasattr(block, "type") and block.type == "text":
            verification_text += block.text

    return {
        "original_answer": answer,
        "verification_result": verification_text,
        "verified": True
    }


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุทูุจ ุงูููุงููุฉ ุนูู ุงูุชูุซูู
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

def request_documentation_consent(assessment_results: dict) -> str:
    """
    ุฅุนุฏุงุฏ ุฑุณุงูุฉ ุทูุจ ุงูููุงููุฉ ูุจู ุงูุชูุซูู

    Args:
        assessment_results: ูุชุงุฆุฌ ุงูุชูููู ูู full_case_assessment()

    Returns:
        ูุต ุฑุณุงูุฉ ุงูููุงููุฉ
    """
    return f"""
๐ **ุทูุจ ููุงููุฉ ุนูู ุงูุชูุซูู**

ุจูุงุกู ุนูู ุงูุชูููู ุงูุฐู ุฃุฌุฑููุงูุ ูููููู ุฅุนุฏุงุฏ ุงููุซุงุฆู ุงูุชุงููุฉ:

1. **ุชูุฑูุฑ ุงูุชูููู ุงูุจุตุฑู ุงููุธููู** (Assessment Report)
2. **ุฎุทุฉ ุงูุชุฃููู ุงูุจุตุฑู** (Treatment Plan)
3. **SOAP Note** โ ููุฎุต ุงูุญุงูุฉ
4. **ุฎุทุงุจ ุฅุญุงูุฉ** (ุฅู ุงุญุชุฌุช)

ูู ุชูุงูู ุนูู ุฅูุดุงุก ูุฐู ุงููุซุงุฆูุ

โ๏ธ **ููุงุญุธุงุช ูููุฉ:**
- ุณุชุชุถูู ุงููุซุงุฆู ุงููุนูููุงุช ุงูุชู ุชูุช ููุงูุดุชูุง ููุท
- ูุฐู ุงููุซุงุฆู ููุงุณุชุฎุฏุงู ุงูุฏุงุฎูู ูุงููุฑุงุฌุนุฉ ุงูููููุฉ
- ูุง ูุชู ุชุฎุฒูู ุฃู ุจูุงูุงุช ุฎุงุฑุฌ ุงูุฌูุณุฉ ุงูุญุงููุฉ
- ุงููุซุงุฆู ุชุญุชุงุฌ ูุฑุงุฌุนุฉ ูู ุงูุฃุฎุตุงุฆู ูุจู ุงูุงุณุชุฎุฏุงู ุงูุฑุณูู

**ููููุงููุฉ**: ุฃุฌุจ ุจู "ูุนูุ ูุงูู ุนูู ุฅูุดุงุก ุงููุซุงุฆู"
"""


if __name__ == "__main__":
    # ูุซุงู ููุงุฎุชุจุงุฑ
    sample_patient = {
        "name": "ู.ุน. (ูุฌููู)",
        "age": 72,
        "diagnosis": "Dry AMD bilateral โ Moderate VI",
        "visual_acuity": {
            "right_eye": "6/60",
            "left_eye": "6/36"
        },
        "visual_field": "Central scotoma bilateral, peripheral intact",
        "chief_complaint": "ุตุนูุจุฉ ูู ุงููุฑุงุกุฉ ูุชูููุฒ ุงููุฌูู",
        "goals": "ุงููุฑุงุกุฉุ ุงูุทุจุฎุ ุงูุงุณุชููุงููุฉ ุงูููููุฉ",
        "medical_history": "ูุง ููุฌุฏ ุฃูุฑุงุถ ูุฒููุฉ ุฃุฎุฑู",
        "living_situation": "ูุนูุด ูุน ุงูุฃุณุฑุฉ"
    }

    results = full_case_assessment(sample_patient, include_pubmed_search=False)

    print("\n" + "=" * 60)
    print("๐ ููุฎุต ุงููุชุงุฆุฌ:")
    print("=" * 60)
    for phase, content in results.items():
        if isinstance(content, str) and len(content) > 100:
            print(f"\n[{phase}]: {content[:200]}...")
        else:
            print(f"\n[{phase}]: {content}")
